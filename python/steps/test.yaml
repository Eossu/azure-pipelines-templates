parameters:
  - name: PythonVersion
    type: string
  - name: Coverage
    type: boolean
    default: false

steps:  
  - script: |
      pytest -rxXs --junitxml=junit/test-results.xm --cov src --cov tests --cov-report xml --cov-report html
    displayName: "Test with pytest"
  
  - task: PublishTestResults@2
    displayName: "Publish test results"
    condition: succeededOrFailed()
    inputs:
      testResultsFiles: '**/test-*.xml'
      testRunTitle: 'Publish test results for Python $(python.version)'
  
  - task: PublishCodeCoverageResults@1
    displayName: "Publish code coverage"
    condition: succeededOrFailed()
    inputs:
      codeCoverageTool: Cobertura
      summaryFileLocation: '$(System.DefaultWorkingDirectory)/**/coverage.xml'
      reportDirectory: '$(System.DefaultWorkingDirectory)/**/htmlcov'
